{{ $CLUSTER := .Cluster}}
{{ $HOST_ID := .HostID }}
{{ $SERVICE_ID := .ServiceID }}
{{ $HOST_DETAILS := .HostDetails }}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="vektor.nyc">
    <!--<link rel="icon" href="../../favicon.ico">-->

    <title>Gaffer</title>

    <!-- Bootstrap core CSS -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="/static/css/dashboard.css" rel="stylesheet">

</head>

<body>

    <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="/gaffer">Gaffer</a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-3 col-md-2 sidebar">
                <ul class="nav nav-sidebar">
                  <center><h3><a href="/gaffer">{{ $CLUSTER }}</a></h3></center>
                    <hr> 
                    {{ range $host := .Hosts }}
                      {{ if eq $HOST_ID $host.ID }}
                      <li class="active"><a href="/gaffer/{{ $host.ID }}">{{ $host.ID }}</a></li>
                        <ul class="list-group">
                        {{ range $service := $HOST_DETAILS.Services }}
                          {{ if eq $SERVICE_ID $service.ID }}
                          <li class="list-group-item active sub"><a href="/gaffer/{{ $host.ID }}/{{ $service.ID }}">{{ $service.ID }}</a></li>
                          {{ else }}
                          <li class="list-group-item"><a href="/gaffer/{{ $host.ID }}/{{ $service.ID }}">{{ $service.ID }}</a></li>
                          {{ end }}
                        {{ end }}
                        </ul>
                      {{ else }}
                      <li><a href="/gaffer/{{ $host.ID }}">{{ $host.ID }}</a></li>
                      {{ end }}
                    {{ end }}
                </ul>
            </div>
            <!--main section-->
          <div class="col-md-offset-2 main">
            {{if .HostDetails}}
            <h2 class="page-header">{{$HOST_ID}}</h2> 
            {{else}}
            <h2 class="page-header">Overview</h2> 

              <div class="row"> 
                <!-- overview -->
                {{ if .HostDetails }}
                {{ else }}
                <div class="progress">
                    {{ if eq .State.String "DEGRADED" }}
                    <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="{{.Progress}}" aria-valuemin="0" aria-valuemax="100" style="width: {{.Progress}}%;">
                      {{ .State.String }}
                      </div>
                      {{ else }}
                    <div class="progress-bar" role="progressbar" aria-valuenow="{{.Progress}}" aria-valuemin="0" aria-valuemax="100" style="width: {{.Progress}}%;">
                      {{ .State.String }}
                      </div>
                    {{ end }}  
                  </div>
                  {{ end }}

            {{end}}

                <!-- end overview -->

                <!-- host details -->
                {{ if .HostDetails }}
                <div class="col-md-3">
                  <div class="panel panel-default">
                      <div class="panel-heading">
                        <h3 class="panel-title">STATUS</h3>
                      </div>
                      <div class="panel-body">
                        <canvas id="hostServices" max-width="150" height="200"></canvas>
                        <hr>
                        <ul class="list-group">
                          <li class="list-group-item">
                            {{ if .HostDetails.Host.Registered }}
                            Registration: <span class="label label-success">registered</span>
                            {{ else }}
                            Registration: <span class="label label-default">pending</span>
                            {{ end }}
                          </li>
                          <li class="list-group-item">
                          {{ if .Recent .HostDetails.Host.LastContacted }}
                            Last Contacted: <span class="label label-success">{{ .HostDetails.Host.TimeSinceLastContacted }}</span>
                          {{ else }}
                            Last Contacted: <span class="label label-danger">{{.HostDetails.Host.TimeSinceLastContacted}}</span>
                          </li>
                          <li class="list-group-item">
                            Hostname : {{.HostDetails.Host.Hostname}}
                          </li>
                          <li class="list-group-item">
                          </li>
                        </ul>
                        {{ end }}
                      </div>
                    </div>
                </div>
                {{ end }}
                <!-- end host details -->
                <!-- service details -->
                {{ if .ServiceDetails }}
                <div class="col-md-9">
                  <div class="panel panel-default">
                      <div class="panel-heading">
                        <h3 class="panel-title">{{ .ServiceDetails.Service.ID }}</h3>
                      </div>
                      <div class="panel-body">
                        <h4> args </h4>
                        <div class="well well-sm">
                        <code>{{.ServiceDetails.Args}}</code>
                        </div>
                        <hr>
                        <div class="col-md-6">
                          <h4> environment variables </h4>
                          <hr>
                          <ul class="list-group">
                            {{ range .ServiceDetails.Service.Environment }}
                            <li class="list-group-item">
                              <code>{{.Name}}={{.Value}}</code>
                            </li>
                            {{ end }}
                          </ul>
                        </div>
                        <div class="col-md-6">
                          <h4> files </h4>
                          <hr>
                          <ul class="list-group">
                            {{ range .ServiceDetails.Service.Files }}
                            <li class="list-group-item">
                              {{ .Path }}
                              <br>
                              <code>
                              {{ .Content }}
                              </code>
                            </li>
                            {{ end }}
                          </ul>
                        </div>
                      </div>
                    </div>
                </div>
                {{end}}
                <!-- end service details -->

              </div>
            </div>
            <!-- end -->
        </div>
    </div>
    <footer class="footer">
      <div class="container">
        <p class="text-muted">
        <a href="https://github.com/vektorlab/gaffer">github</a>
        </p>
      </div>
    </footer>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/chart.bundle.min.js"></script>
    <script>
      // For a pie chart
      var data = {
          labels: [
              "Running",
              "Faulted"
          ],
          datasets: [
              {
                data: [{{.ServicesRunning}}, {{.ServicesFaulted}}],
                  backgroundColor: [
                      "#27ba4d",
                      "#d9534f"
                  ],
                  hoverBackgroundColor: [
                      "#27ba4d",
                      "#d9534f"
                  ]
              }]
      };
      var ctx = document.getElementById("hostServices");
      var myPieChart = new Chart(ctx,{
          type: 'pie',
          data: data,
          options: {animation: false}
      });
    </script>
</body>

</html>
